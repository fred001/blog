
  # 防火墙

      version:  1
      created_at:  2016-01-22
      updated_at:  None

      created at 2016-01-22 15:51:36 


      None


      <p>
      防火墙

历史：
2015年10月08日
建立




有两种防火墙 ： tcp wrappers  和  iptables (centos 6)

 TCP wrappers
 	通过 /etc/hosts.allow, /etc/hosts.deny 进行管理
	只有底下的软件才能够透过这两个档案来管理防火墙规则,分别是: 
	由 super daemon (xinetd) 所管理的服务; 
	有支援 libwrap.so 模块的服务。  （通过 ldd 查询对应的程序 是否  连接libwrap库如：  ldd httpd） 

/etc/hosts.{allow|deny} 的设定方式 
service(program_name) : IP | domain | hostname

先以 /etc/hosts.allow 为优先比对,该规则符合就予以放行; 
再以 /etc/hosts.deny 比对,规则符合就予以抵挡; 
若不在这两个档案内,亦即规则都不符合,最终则予以放行。 

[root@www ~]# vim /etc/hosts.allow 
ALL: 127.0.0.1    <==这就是本机全部的服务都接受! 
rsync: 192.168.1.0/255.255.255.0 10.0.0.100 



iptables:
	查看：  iptables -L  -n    , iptables-save
	清除所有规则：  iptables -F  , iptables -X ,iptables -Z
	-F :清除所有的已订定的规则; 
-X :杀掉所有使用者 "自定义" 的 chain (应该说的是 tables )啰; 
-Z :将所有的 chain 的计数与流量统计都归零

保存规则：  /etc/init.d/iptables save

iptables-save [-t table] 
选项与参数: 
-t :可以仅针对某些表格来输出,例如仅针对 nat 或 filter 等等 


设置规则：
	 
[root@www ~]# iptables [-t nat] -P [INPUT,OUTPUT,FORWARD] [ACCEPT,DROP] 
选项与参数: 
-P :定义政策( Policy )。注意,这个 P 为大写啊! 
ACCEPT :该封包可接受 
DROP :该封包直接丢弃,不会让 client 端知道为何被丢弃。 
范例:将本机的 INPUT 设定为 DROP ,其他设定为 ACCEPT 
[root@www ~]# iptables -P INPUT 
DROP 
[root@www ~]# iptables -P OUTPUT ACCEPT 
[root@www ~]# iptables -P FORWARD ACCEPT 
[root@www ~]# iptables-save 
# Generated by iptables-save 


[root@www ~]# iptables [-AI 链名] [-io 网络接口] [-p 协议] \ 
> [-s 来源 IP/网域] [-d 目标 IP/网域] -j [ACCEPT|DROP|REJECT|LOG] 
选项与参数: 
-AI 链名:针对某的链进行规则的 "插入" 或 "累加" 
-A :新增加一条规则,该规则增加在原本规则的最后面。例如原本已经 
有四条规则, 
使用 -A 就可以加上第五条规则! 
-I :插入一条规则。如果没有指定此规则的顺序,默认是插入变成第一 
条规则。 
例如原本有四条规则,使用 -I 则该规则变成第一条,而原本四条 
变成 2~5 号 
链 :有 INPUT, OUTPUT, FORWARD 等,此链名称又与 -io 有关,请看底 
下。 
-io 网络接口:设定封包进出的接口规范 
-i :封包所进入的那个网络接口,例如 eth0, lo 等接口。需与 INPUT 链 
配合; 
-o :封包所传出的那个网络接口,需与 OUTPUT 链配合; 
-p 协定:设定此规则适用于哪种封包格式 
主要的封包格式有: tcp, udp, icmp 及 all 。 
net.qiang@hotmail.com-s 来源 IP/网域:设定此规则之封包的来源项目,可指定单纯的 IP 或包括 
网域,例如: 
IP :192.168.0.100 
网域:192.168.0.0/24, 192.168.0.0/255.255.255.0 均可。 
若规范为『不许』时,则加上 ! 即可,例如: 
-s ! 192.168.100.0/24 表示不许 192.168.100.0/24 之封包来源; 
-d 目标 IP/网域:同 -s ,只不过这里指的是目标的 IP 或网域。 
-j :后面接动作,主要的动作有接受(ACCEPT)、丢弃(DROP)、拒绝(REJECT) 
及记录(LOG) 


iptables -A INPUT -i eth1 -s 192.168.100.0/24 -j ACCEPT 
# 由于是内网就接受,因此也可以称之为『信任网域』啰。 

iptables [-AI 链] [-io 网络接口] [-p tcp,udp] \ 
> [-s 来源 IP/网域] [--sport 埠口范围] \ 
> [-d 目标 IP/网域] [--dport 埠口范围] -j [ACCEPT|DROP|REJECT] 
net.qiang@hotmail.com选项与参数: 
--sport 埠口范围:限制来源的端口口号码,端口口号码可以是连续的,例如 
1024:65535 
--dport 埠口范围:限制目标的端口口号码。 


范例:想要联机进入本机 port 21 的封包都抵挡掉: 
[root@www ~]# iptables -A INPUT -i eth0 -p tcp --dport 21 -j DROP 
范例:想连到我这部主机的网芳 (upd port 137,138 tcp port 139,445) 就 
放行 
[root@www ~]# iptables -A INPUT -i eth0 -p udp --dport 137:138 -j ACCEPT 
[root@www ~]# iptables -A INPUT -i eth0 -p tcp --dport 139 -j ACCEPT 
[root@www ~]# iptables -A INPUT -i eth0 -p tcp --dport 445 -j ACCEPT

      </p>

  