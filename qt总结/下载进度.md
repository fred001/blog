#!/usr/bin/env python
#-*- coding: utf-8 -*- 
#python 2.7

import sys,os
import math
from PyQt4.QtCore import *
from PyQt4.QtGui import *

from collections import OrderedDict as Dict
import markdown
import urllib


sys.path.append('/home/share/lib/python')
from functions import * 

import requests



class Widget(QDialog):
  def __init__(self):
    super(Widget,self).__init__()


  def set_ui(self):
    self.resize(852, 702)
    self.progressbar = QProgressBar(self)
    self.progressbar.setGeometry(QRect(110, 140, 231, 71))
    self.progressbar.setRange(0,100)

    self.widget = QWidget(self)
    self.widget.setGeometry(QRect(70, 80, 429, 29))
    self.horizontalLayout = QHBoxLayout(self.widget)
    self.horizontalLayout.setMargin(0)
    self.label_2 = QLabel(self.widget)
    self.label_2.setText("URL")
    self.horizontalLayout.addWidget(self.label_2)
    self.input_url = QLineEdit(self.widget)
    self.input_url.setMinimumSize(QSize(300, 0))
    self.input_url.setText("http://127.0.0.1/bg.jpg")
    self.horizontalLayout.addWidget(self.input_url)
    self.btn_download = QPushButton(self.widget)
    self.btn_download.setText("Download")
    self.horizontalLayout.addWidget(self.btn_download)

    self.btn_download.clicked.connect(self.on_download)

  def on_download(self):
    url=self.input_url.text()
    url=unicode(url)
    r=requests.head(url)
    #print r.headers['Content-Length']

    urllib.urlretrieve(url, "/home/ww/bg.jpg", reporthook=self.report)
    #urllib.urlretrieve(url, None, reporthook=self.report)

  def report(self,count, blockSize, totalSize):
    percent = int(count*blockSize*100/totalSize)
    print "FETCHING..." ,count,blockSize,totalSize ,percent

    self.progressbar.setValue(percent)

if __name__ == "__main__":
  app = QApplication(sys.argv)

  w=Widget()
  w.set_ui()
  w.show()

  sys.exit(app.exec_())

  QFont font("ZYSong18030",12);  
  progressDlg->setFont(font);  
  progressDlg->setWindowModality(Qt::WindowModal);  
  progressDlg->setMinimumDuration(5);  
  progressDlg->setWindowTitle(tr("please wait"));  
  progressDlg->setLabelText(tr("正在复制......      "));  
  progressDlg->setCancelButtonText(tr("取消"));  
  progressDlg->setRange(0,num);
