
  # 游戏引擎开发

      version:  1
      created_at:  2016-04-23
      updated_at:  None

      created at 2016-04-23 19:57:17 


      None


      <p>
      29, 利用月影传说素材，先尝试实现游戏
有目前不会的地方，记录下来，不一定非要马上解决，比如 边缘高亮
重点在于完成整体框架


以青蛇为模仿对象：
1， 苏州城地图
2, 苏州城全图 （地图可以移动）
3， 小青 在地图上
4， 鼠标右键，移动小青
5， 路人在地图上， 
6， 路人查看高亮
7， 和路人对话

技术预备：
简单事件 -> 复合事件


1， 支持拖动图像
2， 支持上下左右方向键一个像素拖动图像
3， 支持 显示图像信息： 尺寸，位置，文件名
4支持记录当前状态 save/load














事件： 
QUIT none 


ACTIVEEVENT gain, state 


KEYDOWN unicode, key, mod 
KEYUP key, mod 


MOUSEMOTION pos, rel, buttons 


MOUSEBUTTONUP pos, button 
MOUSEBUTTONDOWN pos, button 


VIDEORESIZE size, w, h 
VIDEOEXPOSE none 


USEREVENT code 




click 
lclick 
rclick 
dbclick 
keypress 


其他独立事件 


middle scroll ? 




判断次序： 
dbclick 
click / lclick 
mclick 
rclick 
keypress 


判断规则： 
dblcick: 
mouse up + mouse down +mouse up+mouse down 且 两个mouse up+mouse down 间隔在极小范围呢 


各类click : mouse up+ mouse down 
keypress: 
keyup + keydown 


一旦时间确定，就清除队列 


伪代码： 
while event.query not empyt: 
pop and push to EVENT 队列 
if event.type == KEYUP, MOUSE_UP: 
进行复合事件检测 


事件是一个队列，一边压入，另一边弹出， 
压入这边是事件产生 
弹出是事件处理 
两边不许要考虑对方的存在 


压入这边对复合时间进行整合，若产生则相应增加新的复合事件 




MDOWN , MUP,CLICK(主动产生的）,MUP,MDOWN ,DBCLICK(主动产生的）.. 


问题：. 
middle scroll ? 
mouse over ? (应该知识 mouse move事件， over是处理时候的判断进行提升的） ，事件生成不用管 


class Event: 
QUEUE:[] 
run: 
while(true); 
read event from event query 
push to QUEUE 
if evnet.type is KEYUP OR MOUSE UP 
CHECK_MULTI_EVENT 
CHECK_MULTI_EVENT: 
if last == M_UP and last-1 == MOUSE_DOWN and last-2 == CLICK: 
last+1=dbclick 
elif last == M_UP and last -1 == MOUSE_DOWN: 
last+1=click 
elif last K_UP and last-1 == K_DOWN: 
last+=1=keypress 

      </p>

  