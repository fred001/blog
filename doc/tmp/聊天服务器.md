# 聊天服务器

一般是遵循xmpp开源聊天协议实现的。 
有众多的服务端和客户端。

服务端有openfire, jabberd2 等， 因为jabberd2在yum源中，所以选择了它。 
客户端比如 empathy ,gnome下默认的聊天客户端。

本文介绍使用  jabberd2 + empathy 实现一个聊天服务器。
只是初步功能，没有ssl加密，没有聊天机器人。


#### 1. 安装

    yum install jabberd

#### 2. 初始化数据库
mysql:  create database  jabberd2 

数据库导入文件是： /usr/share/jabberd/db-setup.mysql
先注释掉第一行的 create database jabberd2  (官方教程有误)
mysql -u root -p jabberd2 < /usr/share/jabberd/db-setup.mysql

再创建对应帐号
GRANT ALL PRIVILEGES ON jabberd2.* TO 'jabberd2'@'iamlosing.me' IDENTIFIED BY '123' WITH GRANT OPTION;
flush privileges; 

创建用户帐号
insert into authreg (username, realm, password) values ('frd', 'iamlosing.me', '123'); 
              

##### 3.编辑配置
/etc/jabberd/c2s.xml
修改本机域名
<local>
  <id>somemachine.somedomain.com</id>  

修改存储， 默认是sqlite, 需要修改 成mysql,并且去mysql修改连接参数
                                          
/etc/jabberd/sm.xml (同c2s.xml)
修改本机域名
修改存储

但是还需要开启  auto-create, 
如果不开启， 就不知道怎么才能创建用户，光表里创建似乎不够
注释掉  <auto-create/> 即可

#### 4.启动服务 
  systemctl start jabberd

#### 5.客户端设置

客户端：  empathy 
创建帐号：  frd@iamlosing.me , 密码 123 
服务器是  iamlosing.me 


#### 6.参考
官方安装教程
  https://github.com/jabberd2/jabberd2/wiki/InstallGuide-QuickStartGuideRPM
