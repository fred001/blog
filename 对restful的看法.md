
  # 对restful的看法

      version:  1
      created_at:  2016-01-22
      updated_at:  None

      created at 2016-01-22 15:26:17 


      None


      <p>
      
restful最近忽然很火，似乎是网站都需要以此为范。zf2有个模块 agility, 甚至有个专门的支持restful的框架。我很不理解它究竟有什么好处。




我认为它并不好。 
	第一，http协议是面向资源，然而建立在http上层的网站可不是必须面向资源的，事实上，面向对象才是更为常见。网站和http协议处于两个不同层次， 现在将网站以http的模式来实现，概念上就是误区。
	实践中遇到的诸多问题，不少是因为http协议本身和网站本身概念存在冲突和混淆。比如网站也用http返回码表示错误， 那么真正的http返回码错误和网站的返回码错误就混在一起了，很难分辨究竟问题出在哪里。又这个概念依赖http的几个有限动作，然而网站需要的功能更为丰富，有限的动作无法表达，且很难将所有网站本身动作映射成对应的http动作。
	第二，这个概念的论文2000年时候发表，那时候还是soap等概念存在的时候，距今15年了。我很怀疑这个概念是否还有价值。

	然而究竟怎么做好？ 我以为在http协议之上建立一个简单的架构，完全已经足够。那些所说的restful优点，例如无状态等等，难道不是已经存在了吗？ 只要使用http协议，不用做多余的内容，本身就是无状态的。非要将网站api改写成restful，简直是画蛇添足。

restful概念api实践中有几个重要的麻烦点。
	一是十分依赖URL的表达，所以路由重写非常重要且复杂，并且部分必要信息存在于路由中，这在开发中造成了额外巨大的成本。并且路由规划也是很难一次成型的，一变动，又是大量的成本。
	二是混淆了http本身和之上的网站api,导致故障判断十分困难。比如访问一个api,返回404错误，那么是访问地址不对呢，还是网络不通，还是另有缘故？鉴于网站本身可能产生问题，导致api失败，所以这种混淆导致无法准确判断问题之所在，对于调试真是噩梦。

事实上，利用简单的GET,POST,完全可以实现一个轻松直观的api. 第二著名的视频网站 vimeo,就是这样很务实，利用简单明了的api方法名，实现了一个简单易用的api。相反那些restful 的api,简直难用。
关于api返回，我建议一定要包含两个值，  error 和  error_code。 对于api请求，可能存在3种情况。 第一是连接失败，比如对方网站故障。第二是连接成功，我方请求有误。第三是连接成功，对方返回有误。
第一种依赖http本身状态码来判断，
第二种依赖 error ，error_code 值判断,对方需要告知具体的错误，或者不知道也需要告知是未知错误。
第三种依赖返回信息格式，比如要求是json,若不是，则认为对方api暂时存在故障。

事实上还有第四种，对方返回正确的格式，但是内容本身有错误。这可能需要api sdk本身提供返回值校验，属于网站层次上的问题，应有解决办法，只是可能一般假定对方api返回值必定是正确的，所以从未见过api sdk有类似判断。

这就是个很简单的模型，很容易实现，也很容易调试，甚至很容易扩展。我觉得这完全胜过restful 这个概念。 况且15年前的理论，实在需要仔细判断，现在蜂拥而上地使用这个概念，没看出有什么好处。
 	

我猜测未来的软件和网站，应该是面向对象，且逐渐拥有智能。restful不足以成为未来的趋势。

参考：
http://www.ruanyifeng.com/blog/2011/09/restful
      </p>

  